---
title: 位运算符
date: 2020-1-04
tags:
 - js
categories:
 -  js小知识
---    

##  位运算符    

###  简介       

1. 位运算符包括7种：按位非（NOT）、按位与（AND）、按位或（OR）、按位异或（XOR）、左移、有符号右移、无符号右移    
2. JavaScript 将数字存储为 64 位浮点数，但所有按位运算都以 32 位二进制数执行。在执行位运算之前,JavaScript 将数字转换为 32 位有符号整数。执行按位操作后，结果将转换回 64 位 JavaScript 数     

###  分类       

1. 按位与(AND) `&`       

  +  `&`以特定的方式组合操作二进制数中对应的位，如果对应的位都为1，那么结果就是1， 如果任意一个位是0 则结果就是0。    
      ```js   
        // 1的二进制表示为: 00000000 00000000 00000000 00000001
        // 3的二进制表示为: 00000000 00000000 00000000 00000011
        // -----------------------------
        // 1 & 3的二进制表示为: 00000000 00000000 00000000 00000001
        console.log(1 & 3)     // 1
      ```     

2. 按位或(OR) `|`     

    + `|`运算符跟 `&` 的区别在于如果对应的位中任一个操作数为1 那么结果就是1。    
        ```js   
            // 1的二进制表示为: 00000000 00000000 00000000 00000001
            // 3的二进制表示为: 00000000 00000000 00000000 00000011
            // -----------------------------
            // 1 | 3的二进制表示为: 00000000 00000000 00000000 00000011
            console.log(1 | 3)     // 3    
        ```     

3. 按位异或(XOR) `^`      

    + `^` 如果对应两个操作位有且仅有一个1时结果为1，其他都是0。     
        ```js     
            // 1的二进制表示为: 00000000 00000000 00000000 00000001
            // 3的二进制表示为: 00000000 00000000 00000000 00000011
            // -----------------------------
            // 1 ^ 3的二进制表示为: 00000000 00000000 00000000 00000010
            console.log(1 ^ 3)     // 2     
        ```     
4. 按位非(NOT) `~`      

    + `~` 运算符是对位求反，1变0, 0变1，也就是求二进制的反码。      
        ```js     
            // 1的二进制表示为: 00000000 00000000 00000000 00000001
            // 3的二进制表示为: 00000000 00000000 00000000 00000011
            // -----------------------------
            // 1反码二进制表示: 11111111 11111111 11111111 11111110
            // 由于第一位（符号位）是1，所以这个数是一个负数。JavaScript 内部采用补码形式表示负数，即需要将这个数减去1，再取一次反，然后加上负号，才能得到这个负数对应的10进制值。
            // -----------------------------
            // 1的反码减1：     11111111 11111111 11111111 11111101
            // 反码取反：       00000000 00000000 00000000 00000010
            // 表示为10进制加负号：-2
            console.log(~ 1)     // -2    
        ```   
    +  简单记忆：一个数与自身的取反值相加等于-1。     
5. 左移（Left shift）`<<`     

    +   `<<`运算符使指定值的二进制数所有位都左移指定次数，其移动规则：**丢弃高位，低位补0**即按二进制形式把所有的数字向左移动对应的位数，高位移出(舍弃)，低位的空位补零。     
        ```js     
            // 1的二进制表示为: 00000000 00000000 00000000 00000001
            // -----------------------------
            // 1 << 1的二进制表示为: 00000000 00000000 00000000 00000010
            console.log(1 << 1)     // 2    
        ```     
6. 有符号右移`>>`     

    + `>>`该操作符会将指定操作数的二进制位向右移动指定的位数。向右被移出的位被丢弃，拷贝最左侧的位以填充左侧。由于新的最左侧的位总是和以前相同，符号位没有被改变。所以被称作“符号传播”。      
        ```js   
            // 1的二进制表示为: 00000000 00000000 00000000 00000001
            // -----------------------------
            // 1 >> 1的二进制表示为: 00000000 00000000 00000000 00000000
            console.log(1 >> 1)     // 0    
        ```     
7. 无符号右移`>>>`      

    + `>>>`该操作符会将第一个操作数向右移动指定的位数。向右被移出的位被丢弃，左侧用0填充。因为符号位变成了 0，所以结果总是非负的。（译注：即便右移 0 个比特，结果也是非负的。）
对于非负数，有符号右移和无符号右移总是返回相同的结果。例如， `9 >>> 2` 得到 2 和 `9 >> 2` 相同。      
      

###  妙用     

1. 使用`&`运算符判断一个数的奇偶      
      ```js   
          // 偶数 & 1 = 0
          // 奇数 & 1 = 1
          console.log(2 & 1)    // 0
          console.log(3 & 1)    // 1  
          console.log((44 & 1) === 0)  //true  
      ```

2. 使用`~, >>, <<, >>>, |`来取整      
      ```js     
          console.log(~~ 6.83)    // 6
          console.log(-6.83 >> 0)  // -6
          console.log(6.83 << 0)  // 6
          console.log(6.83 | 0)   // 6
          // >>>不可对负数取整
          console.log(6.83 >>> 0)   // 6      
      ```       

3. 使用`^`来完成值交换      
      ```js     
          var a = 5
          var b = 8
          a ^= b
          b ^= a
          a ^= b
          console.log(a)   // 8
          console.log(b)   // 5     
      ```     
4.  使用`&, >>, |`来完成rgb值和16进制颜色值之间的转换     
      ```js     
          /**
            * 16进制颜色值转RGB
            * @param  {String} hex 16进制颜色字符串
            * @return {String}     RGB颜色字符串
            */
            function hexToRGB(hex) {
              var hexx = hex.replace('#', '0x')
              var r = hexx >> 16
              var g = hexx >> 8 & 0xff
              var b = hexx & 0xff
              return `rgb(${r}, ${g}, ${b})`
          }

          /**
          * RGB颜色转16进制颜色
          * @param  {String} rgb RGB进制颜色字符串
          * @return {String}     16进制颜色字符串
          */
          function RGBToHex(rgb) {
              var rgbArr = rgb.split(/[^\d]+/)
              var color = rgbArr[1]<<16 | rgbArr[2]<<8 | rgbArr[3]
              return '#'+ color.toString(16)
          }
          // -------------------------------------------------
          hexToRGB('#ffffff')               // 'rgb(255,255,255)'
          RGBToHex('rgb(255,255,255)')      // '#ffffff'      
      ```     

5. 使用左移运算符 `<<` 迅速得出2的次方      

      ```js   
          1 << 2  // 4, 即 2的2次方
          1 << 10 // 1024, 即 2的10次方

          // 但是要注意使用场景, 非1的数字，会改变首位的正负
          a = 2e9;   // 2000000000
          a << 1;    // -294967296    
      ```   

6. 使用 `^` 切换变量 0 或 1     

      ```js   
          // --- before ---
          // if 判断
          if (toggle) {
              toggle = 0;
          } else {
              toggle = 1;
          }
          // 三目运算符
          togle = toggle ? 0 : 1;

          // --- after ---
          toggle ^= 1;    
      ```       

7. 使用`^`判断符号是否相同      

      ```js   
          (a ^ b) >= 0; //  true 相同; false 不相同     
      ```     

8.  使用`^`来检查数字是否不相等     

      ```js   
           // --- before --- 
          if (a !== 1171) {...};  
          // --- after --- 
          if (a ^ 1171) {...};    
      ```     

9. `n & (n - 1)`，如果为 0，说明 n 是 2 的整数幂    

      ```js   
          function isPowerOf2(x) {
            return (x & (x - 1)) === 0
          }
          console.log(isPowerOf2(4))  //true
          console.log(isPowerOf2(1024))  //true
          console.log(isPowerOf2(1023))   //false   
      ```   

10. 使用 `A + 0.5 | 0` 来替代 `Math.round()`      

      ```js   
           console.log(2.5 + 0.5 >> 0)    //3
           console.log(2.0 + 0.5 | 0)     //2
           console.log(2.8 + 0.5 | 0)     //3   
      ```
